<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:validation="http://www.mulesoft.org/schema/mule/validation" xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
	xmlns:http="http://www.mulesoft.org/schema/mule/http"
	xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/validation http://www.mulesoft.org/schema/mule/validation/current/mule-validation.xsd">
	<sub-flow name="logicSub_Flow" doc:id="e76415f1-45f5-4b22-bc27-e494a8882721" >
		<logger level="INFO" doc:name="flowStartLogger" doc:id="9365cdaa-96bf-4c17-9a64-5bed58592c00" />
		<try doc:name="Try" doc:id="703020dc-6399-4146-943b-aef7bb0d78c0" >
			<http:request method="POST" doc:name="enroller" doc:id="03298cee-640a-40f9-9e5b-2233ceebeb21" config-ref="HTTP_Request_configuration" path="/enroller">
				<http:headers ><![CDATA[#[{
	"client_id": attributes.headers.client_id,
	"client_secret": attributes.headers.client_secret
}]]]></http:headers>
			</http:request>
			<error-handler >
				<on-error-continue enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="1981a45e-2347-4fcf-8c9d-5d54d4fc7444" type="ANY">
					<set-variable value="#[error]" doc:name="Error" doc:id="d916b8f8-cc73-466d-a735-573946b83280" variableName="Error"/>
				</on-error-continue>
			</error-handler>
		</try>
		<try doc:name="Try" doc:id="8f04a4a2-9d9a-4d92-9c5b-5ccc10fdc8bb" >
			<validation:is-null doc:name="var Error is null?" doc:id="b1a641aa-73d2-430a-991d-c31831ac1c95" value="#[vars.Error]"/>
			<error-handler >
				<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="f57fa859-370e-4078-9316-35056b6b1b82" type="VALIDATION:NOT_NULL">
					<ee:transform doc:name="httpStatus" doc:id="a7aa58d5-fee1-4deb-b7e3-69b2452d059c" >
						<ee:message >
						</ee:message>
						<ee:variables >
							<ee:set-variable variableName="httpStatus" ><![CDATA[vars.Error.errorMessage.attributes.statusCode]]></ee:set-variable>
						</ee:variables>
					</ee:transform>
					<raise-error doc:name="APP:ENROLMENT_FAILURE" doc:id="2326eef8-67ba-495a-8042-214903818934" type="APP:ENROLMENT_FAILURE" description="#[vars.Error.errorMessage.payload.error_message]"/>
				</on-error-propagate>
			</error-handler>
		</try>
		<ee:transform doc:name="Response Message" doc:id="fc088657-d8f8-4b40-b639-263b7c5735a9" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
payload]]></ee:set-payload>
			</ee:message>
			<ee:variables >
			</ee:variables>
		</ee:transform>
		<logger level="INFO" doc:name="endLogger" doc:id="f62f7c98-dca7-4e69-be08-e7d4ef926c6c" />
	</sub-flow>
</mule>
